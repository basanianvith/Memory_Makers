@{
    ViewData["Title"] = "Bookings";
    Layout = "~/Views/Shared/_AdminLayout.cshtml";
}

<div class="admin-page bookings-page">

    <h2 class="page-heading">Bookings Management</h2>
    <p class="page-subtext">
        Review, confirm and manage all customer bookings
    </p>

    <!-- ================= STATUS TABS ================= -->
    <div class="booking-tabs">
        <div class="btab active" data-status="Pending Confirmation">Pending Confirmation</div>
        <div class="btab" data-status="Confirmed">Confirmed</div>
        <div class="btab" data-status="Completed">Completed</div>
        <div class="btab" data-status="Cancelled">Cancelled</div>
    </div>

    <!-- ================= FILTER ================= -->
    <div class="booking-filters">
        <input type="text" id="searchBox" placeholder="Search by Booking ID / Customer / Package" />
    </div>

    <!-- ================= GRID ================= -->
    <div id="bookingGrid" class="booking-grid"></div>

    <!-- ================= DETAILS MODAL ================= -->
    <div class="custom-modal" id="bookingModal">
        <div class="modal-box large-modal">

            <h4>Booking Details</h4>

            <div class="details-grid">
                <div><b>Booking ID:</b> <span id="bId"></span></div>
                <div><b>Status:</b> <span id="bStatus"></span></div>

                <div><b>Customer:</b> <span id="bCustomer"></span></div>
                <div><b>Phone:</b> <span id="bPhone"></span></div>

                <div><b>Package:</b> <span id="bPackage"></span></div>
                <div><b>Destination:</b> <span id="bDest"></span></div>

                <div><b>Duration:</b> <span id="bDuration"></span></div>
                <div><b>Travelers:</b> <span id="bPeople"></span></div>

                <div><b>Amount Paid:</b> ₹<span id="bAmount"></span></div>
                <div><b>Payment:</b> <span class="paid-text">Paid</span></div>
            </div>

            <div class="modal-actions">
                <button class="btn-confirm-booking" id="confirmBtn">Confirm Booking</button>
                <button class="btn-reject" id="cancelBtn">Cancel & Refund</button>
                <button class="btn-cancel" onclick="closeModal()">Close</button>
            </div>

        </div>
    </div>

</div>

<!-- ================= jQuery ================= -->
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>

<script>
    let bookings = [
        { id:"BK2001", customer:"Riya Sharma", phone:"9876543210", pkg:"Goa Delight", dest:"Goa", duration:"5 Days", people:2, amount:14999, status:"Pending Confirmation" },
        { id:"BK2002", customer:"Aman Verma", phone:"9988776655", pkg:"Manali Escape", dest:"Manali", duration:"6 Days", people:4, amount:18999, status:"Confirmed" },
        { id:"BK2003", customer:"Neha Gupta", phone:"9123456780", pkg:"Kerala Calm", dest:"Kerala", duration:"5 Days", people:3, amount:17999, status:"Completed" },
        { id:"BK2004", customer:"Rahul Jain", phone:"9012345678", pkg:"Rajasthan Royal", dest:"Jaipur", duration:"7 Days", people:5, amount:21999, status:"Cancelled" },
        { id:"BK2005", customer:"Sneha Kapoor", phone:"8899776655", pkg:"Ladakh Adventure", dest:"Ladakh", duration:"8 Days", people:1, amount:25999, status:"Pending Confirmation" },
        { id:"BK2006", customer:"Kunal Mehta", phone:"9345678901", pkg:"Andaman Bliss", dest:"Andaman", duration:"6 Days", people:2, amount:29999, status:"Confirmed" },
        { id:"BK2007", customer:"Pooja Nair", phone:"9001122334", pkg:"Munnar Escape", dest:"Munnar", duration:"4 Days", people:2, amount:13999, status:"Pending Confirmation" },
        { id:"BK2008", customer:"Arjun Singh", phone:"9011223344", pkg:"Shimla Snow", dest:"Shimla", duration:"5 Days", people:3, amount:16999, status:"Completed" },
        { id:"BK2009", customer:"Megha Shah", phone:"9811223344", pkg:"Udaipur Royal", dest:"Udaipur", duration:"3 Days", people:2, amount:12999, status:"Confirmed" },
        { id:"BK2010", customer:"Yash Patel", phone:"9822334455", pkg:"Rishikesh Trip", dest:"Rishikesh", duration:"3 Days", people:4, amount:9999, status:"Cancelled" },
        { id:"BK2011", customer:"Anjali Das", phone:"9833445566", pkg:"Darjeeling Calm", dest:"Darjeeling", duration:"5 Days", people:2, amount:18999, status:"Pending Confirmation" },
        { id:"BK2012", customer:"Rohan Malhotra", phone:"9877665544", pkg:"Kashmir Heaven", dest:"Kashmir", duration:"7 Days", people:2, amount:27999, status:"Confirmed" }
    ];

    let currentStatus = "Pending Confirmation";
    let selectedBooking = null;

    function renderBookings() {
        let grid = $("#bookingGrid").html("");
        let search = $("#searchBox").val()?.toLowerCase();

        let filtered = bookings.filter(b =>
            b.status === currentStatus &&
            (!search || b.customer.toLowerCase().includes(search) || b.pkg.toLowerCase().includes(search) || b.id.toLowerCase().includes(search))
        );

        if (filtered.length === 0) {
            grid.html(`<p class="empty-text">No bookings found</p>`);
            return;
        }

        filtered.forEach(b => {
            grid.append(`
                <div class="booking-card glow-card">
                    <div class="booking-top">
                        <span class="booking-id">${b.id}</span>
                        <span class="status-badge ${b.status.replace(" ","-").toLowerCase()}">${b.status}</span>
                    </div>

                    <h4>${b.customer}</h4>
                    <p>${b.pkg} • ${b.dest}</p>

                    <div class="booking-info">
                        <span>₹${b.amount}</span>
                        <span>${b.people} Travelers</span>
                    </div>

                    <button onclick="viewBooking('${b.id}')">View & Take Action</button>
                </div>
            `);
        });
    }

    function viewBooking(id) {
        selectedBooking = bookings.find(b => b.id === id);

        $("#bId").text(selectedBooking.id);
        $("#bStatus").text(selectedBooking.status);
        $("#bCustomer").text(selectedBooking.customer);
        $("#bPhone").text(selectedBooking.phone);
        $("#bPackage").text(selectedBooking.pkg);
        $("#bDest").text(selectedBooking.dest);
        $("#bDuration").text(selectedBooking.duration);
        $("#bPeople").text(selectedBooking.people);
        $("#bAmount").text(selectedBooking.amount);

        $("#confirmBtn").toggle(selectedBooking.status === "Pending Confirmation");
        $("#cancelBtn").toggle(selectedBooking.status !== "Cancelled");

        $("#bookingModal").addClass("show");
    }

    function closeModal() {
        $("#bookingModal").removeClass("show");
    }

    $("#confirmBtn").click(function () {
        selectedBooking.status = "Confirmed";
        closeModal();
        renderBookings();
        alert("Booking confirmed successfully");
    });

    $("#cancelBtn").click(function () {
        selectedBooking.status = "Cancelled";
        closeModal();
        renderBookings();
        alert("Booking cancelled. Refund will be initiated.");
    });

    $(document).ready(function () {
        renderBookings();

        $(".btab").click(function () {
            $(".btab").removeClass("active");
            $(this).addClass("active");
            currentStatus = $(this).data("status");
            renderBookings();
        });

        $("#searchBox").on("input", renderBookings);
    });
</script>